<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ thống phát hiện phương tiện giao thông</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { min-height: 100vh; display: flex; flex-direction: column; background: linear-gradient(135deg, #f0f2f5 0%, #e6e9f0 100%); }
        .header { background: white; padding: 1rem 2rem; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); position: fixed; width: 100%; top: 0; z-index: 1000; }
        .header-content { max-width: 1200px; margin: 0 auto; display: flex; justify-content: flex-start; align-items: center; gap: 0.5rem; color: #3182ce; font-size: 1.5rem; font-weight: 600; }
        .header-content i { font-size: 2rem; }
        .main-content { flex: 1; display: flex; justify-content: center; align-items: center; padding: 6rem 2rem 2rem; position: relative; }
        .background-decoration { position: absolute; width: 100%; height: 100%; top: 0; left: 0; z-index: -1; opacity: 0.05; }
        .decoration-circle { position: absolute; border-radius: 50%; background: #3182ce; }
        .circle-1 { width: 300px; height: 300px; top: -100px; left: -100px; }
        .circle-2 { width: 200px; height: 200px; bottom: -50px; right: -50px; }
        .container { width: 100%; max-width: 600px; padding: 2rem; animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .upload-container { background: white; border-radius: 12px; padding: 2rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); position: relative; overflow: hidden; }
        .upload-container::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: linear-gradient(90deg, #3182ce, #2c5282); }
        .upload-area { border: 2px dashed #3182ce; border-radius: 8px; padding: 2rem; text-align: center; cursor: pointer; transition: all 0.3s ease; margin-bottom: 1rem; background: #f8fafc; }
        .upload-area:hover { border-color: #2c5282; background: #ebf8ff; transform: translateY(-2px); }
        .upload-area.dragover { background: #ebf8ff; border-color: #2c5282; transform: scale(1.02); }
        .upload-icon { font-size: 3rem; color: #3182ce; margin-bottom: 1rem; animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .upload-text { color: #4a5568; margin-bottom: 0.5rem; font-size: 1.2rem; }
        .upload-hint { color: #718096; font-size: 0.875rem; }
        .upload-button { background: linear-gradient(90deg, #3182ce, #2c5282); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; width: 100%; margin-top: 1rem; }
        .upload-button:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(49, 130, 206, 0.3); }
        .upload-button:disabled { background: #cbd5e0; cursor: not-allowed; transform: none; box-shadow: none; }
        .preview-container { margin-top: 1rem; display: none; animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .preview-image { max-width: 100%; border-radius: 8px; margin-top: 1rem; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); }
        .result-message { margin-top: 1rem; padding: 1rem; border-radius: 6px; display: none; animation: fadeIn 0.3s ease-out; }
        .result-message.success { background: #c6f6d5; color: #2f855a; display: block; }
        .result-message.error { background: #fed7d7; color: #c53030; display: block; }
        .loading { display: none; text-align: center; margin-top: 1rem; }
        .loading-spinner { width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #3182ce; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
<header class="header">
    <div class="header-content">
        <i class="fas fa-car"></i>
        Hệ thống phát hiện phương tiện giao thông
    </div>
</header>

<main class="main-content">
    <div class="background-decoration">
        <div class="decoration-circle circle-1"></div>
        <div class="decoration-circle circle-2"></div>
    </div>

    <div class="container">
        <div class="upload-container">
            <form id="uploadForm">
                <div class="upload-area" id="dropZone">
                    <div class="upload-icon">
                        <i class="fas fa-camera"></i>
                    </div>
                    <div class="upload-text">Kéo thả hình ảnh phương tiện vào đây</div>
                    <div class="upload-hint">hoặc nhấp để chọn file</div>
                    <input type="file" name="file" id="fileInput" accept="image/*" style="display: none;">
                </div>
                <button type="submit" class="upload-button" id="uploadButton" disabled>
                    <i class="fas fa-search"></i> Phát hiện phương tiện
                </button>
            </form>

            <div class="loading" id="loading">
                <div class="loading-spinner"></div>
                <p>Đang phân tích hình ảnh...</p>
            </div>

            <div class="preview-container" id="previewContainer">
                <img id="previewImage" class="preview-image" alt="Preview">
            </div>

            <div class="result-message" id="resultMessage"></div>
        </div>
    </div>
</main>

<script>
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const uploadForm = document.getElementById('uploadForm');
    const uploadButton = document.getElementById('uploadButton');
    const previewContainer = document.getElementById('previewContainer');
    const previewImage = document.getElementById('previewImage');
    const resultMessage = document.getElementById('resultMessage');
    const loading = document.getElementById('loading');

    ['dragenter','dragover','dragleave','drop'].forEach(e => dropZone.addEventListener(e, preventDefaults, false));
    function preventDefaults(e){ e.preventDefault(); e.stopPropagation(); }
    ['dragenter','dragover'].forEach(e => dropZone.addEventListener(e, () => dropZone.classList.add('dragover'), false));
    ['dragleave','drop'].forEach(e => dropZone.addEventListener(e, () => dropZone.classList.remove('dragover'), false));

    dropZone.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', e => handleFiles(e.target.files));
    dropZone.addEventListener('drop', e => handleFiles(e.dataTransfer.files));

    function handleFiles(files){
        if(files.length > 0){
            const file = files[0];
            if(file.type.startsWith('image/')){
                previewFile(file);
                uploadButton.disabled = false;
            } else { showMessage('Vui lòng chọn file hình ảnh', 'error'); }
        }
    }

    function previewFile(file){
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onloadend = () => {
            previewImage.src = reader.result;
            previewContainer.style.display = 'block';
        }
    }

    uploadForm.addEventListener('submit', async function(e){
        e.preventDefault();
        const formData = new FormData(this);
        try{
            loading.style.display = 'block';
            uploadButton.disabled = true;
            resultMessage.className = 'result-message';

            const res = await fetch('http://localhost:8080/api/images/upload', { method: 'POST', body: formData });
            const data = await res.json();

            if(data && data.image){
                previewImage.src = "data:image/jpeg;base64," + data.image;
                previewContainer.style.display = 'block';
                showMessage('Phát hiện thành công!', 'success');
            } else {
                showMessage('Không nhận được ảnh trả về!', 'error');
            }
        } catch(err){
            showMessage('Lỗi kết nối backend!', 'error');
        } finally{
            loading.style.display = 'none';
            uploadButton.disabled = false;
        }
    });

    function showMessage(msg, type){
        resultMessage.textContent = msg;
        resultMessage.className = `result-message ${type}`;
    }
</script>
</body>
</html>
